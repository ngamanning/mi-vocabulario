<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Vocabulario</title>
  <meta name="description" content="Your Spanish learning companion">
  <meta name="theme-color" content="#5d4e37">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Source Sans 3', system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Auto-categorization logic
    const detectCategory = (word, translation, example) => {
      const wordLower = word.toLowerCase();
      const translationLower = translation.toLowerCase();
      
      // Verb patterns
      if (wordLower.endsWith('ar') || wordLower.endsWith('er') || wordLower.endsWith('ir') ||
          wordLower.endsWith('arse') || wordLower.endsWith('erse') || wordLower.endsWith('irse')) {
        return 'Verbs';
      }
      
      // Adverb patterns
      const adverbs = ['casi', 'muy', 'bien', 'mal', 'ya', 'aqu√≠', 'all√≠', 'ahora', 
                       'tambi√©n', 'tampoco', 'solo', 'adem√°s', 'quiz√°s', 'bastante',
                       'demasiado', 'tanto', 'poco', 'mucho', 'pronto', 'tarde', 'lejos'];
      if (wordLower.endsWith('mente') || adverbs.includes(wordLower)) {
        return 'Adverbs';
      }
      
      // Time expressions
      const timeWords = ['ayer', 'hoy', 'ma√±ana', 'luego', 'despu√©s', 'antes', 'siempre', 'nunca', 
                         'normalmente', 'semana', 'mes', 'a√±o', 'd√≠a', 'noche', 'tarde'];
      if (timeWords.some(t => wordLower.includes(t)) || 
          translationLower.includes('yesterday') || translationLower.includes('tomorrow') ||
          translationLower.includes('always') || translationLower.includes('never')) {
        return 'Time Expressions';
      }
      
      // Adjective patterns
      if (wordLower.endsWith('oso') || wordLower.endsWith('osa') || 
          wordLower.endsWith('ivo') || wordLower.endsWith('iva') ||
          wordLower.endsWith('nte') || wordLower.endsWith('ble') ||
          wordLower.endsWith('√≠simo') || wordLower.endsWith('√≠sima') ||
          wordLower.endsWith('ado') || wordLower.endsWith('ada') ||
          wordLower.endsWith('ico') || wordLower.endsWith('ica')) {
        return 'Adjectives';
      }
      
      // Common phrase patterns
      if (word.includes(' ') && (wordLower.startsWith('que ') || wordLower.startsWith('lo ') ||
          wordLower.includes('!') || wordLower.includes('?'))) {
        return 'Common Phrases';
      }
      
      // Prepositions
      const prepositions = ['de', 'a', 'en', 'con', 'por', 'para', 'sin', 'sobre', 'entre', 
                            'hacia', 'desde', 'hasta', 'durante', 'mediante', 'cerca', 'detras', 'delante'];
      if (prepositions.includes(wordLower) || wordLower.endsWith(' de') || wordLower.endsWith(' a')) {
        return 'Prepositions';
      }
      
      // Conjunctions
      const conjunctions = ['y', 'o', 'pero', 'sino', 'porque', 'aunque', 'si', 'cuando', 
                            'mientras', 'como', 'que', 'sin embargo', 'no obstante'];
      if (conjunctions.includes(wordLower)) {
        return 'Conjunctions';
      }
      
      // Indefinite pronouns
      const pronouns = ['algo', 'alguien', 'nada', 'nadie', 'todo', 'todos', 'cada', 'otro', 'alguno'];
      if (pronouns.includes(wordLower)) {
        return 'Indefinite Pronouns';
      }
      
      return 'Nouns';
    };

    const categories = [
      'Adjectives', 'Adverbs', 'Nouns', 'Verbs', 'Time Expressions', 
      'Common Phrases', 'Conjunctions', 'Prepositions', 'Indefinite Pronouns'
    ];

    // API helper functions
    const api = {
      async fetchEntries(scriptUrl) {
        if (!scriptUrl) return null;
        try {
          const response = await fetch(scriptUrl);
          const data = await response.json();
          if (data.success) return data.entries;
          return null;
        } catch (error) {
          return null;
        }
      },
      
      async addEntry(scriptUrl, entry) {
        if (!scriptUrl) return false;
        try {
          await fetch(scriptUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'add', ...entry }),
            mode: 'no-cors'
          });
          return true;
        } catch (error) {
          return false;
        }
      },
      
      async deleteEntry(scriptUrl, id) {
        if (!scriptUrl) return false;
        try {
          await fetch(scriptUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'delete', id }),
            mode: 'no-cors'
          });
          return true;
        } catch (error) {
          return false;
        }
      }
    };

    function VocabularyApp() {
      const [activeTab, setActiveTab] = useState('entry');
      const [entries, setEntries] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [isSyncing, setIsSyncing] = useState(false);
      
      const [scriptUrl, setScriptUrl] = useState(() => {
        return localStorage.getItem('scriptUrl') || '';
      });
      const [tempScriptUrl, setTempScriptUrl] = useState(scriptUrl);
      const [connectionStatus, setConnectionStatus] = useState('unknown');
      
      const [word, setWord] = useState('');
      const [translation, setTranslation] = useState('');
      const [example, setExample] = useState('');
      const [detectedCategory, setDetectedCategory] = useState('Nouns');
      const [categoryOverride, setCategoryOverride] = useState('');
      const [showSuccess, setShowSuccess] = useState(false);
      
      const [chatMessages, setChatMessages] = useState([
        { role: 'assistant', content: '¬°Hola! I\'m Bubble, here to help with your Spanish learning. Ask me for example sentences, related words, or any questions about vocabulary!' }
      ]);
      const [chatInput, setChatInput] = useState('');
      const [isChatLoading, setIsChatLoading] = useState(false);
      const chatEndRef = useRef(null);
      
      useEffect(() => {
        loadEntries();
      }, [scriptUrl]);
      
      const loadEntries = async () => {
        setIsLoading(true);
        
        if (scriptUrl) {
          const apiEntries = await api.fetchEntries(scriptUrl);
          if (apiEntries) {
            setEntries(apiEntries);
            localStorage.setItem('spanishVocab', JSON.stringify(apiEntries));
            setConnectionStatus('connected');
            setIsLoading(false);
            return;
          }
          setConnectionStatus('offline');
        }
        
        const saved = localStorage.getItem('spanishVocab');
        setEntries(saved ? JSON.parse(saved) : []);
        setIsLoading(false);
      };
      
      useEffect(() => {
        if (word || translation) {
          const detected = detectCategory(word, translation, example);
          setDetectedCategory(detected);
        }
      }, [word, translation, example]);
      
      useEffect(() => {
        chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [chatMessages]);
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!word.trim() || !translation.trim()) return;
        
        const newEntry = {
          id: Date.now().toString(),
          word: word.trim(),
          translation: translation.trim(),
          example: example.trim(),
          category: categoryOverride || detectedCategory,
          createdAt: new Date().toISOString()
        };
        
        setEntries(prev => [newEntry, ...prev]);
        localStorage.setItem('spanishVocab', JSON.stringify([newEntry, ...entries]));
        
        if (scriptUrl) {
          setIsSyncing(true);
          await api.addEntry(scriptUrl, newEntry);
          setIsSyncing(false);
        }
        
        setWord('');
        setTranslation('');
        setExample('');
        setCategoryOverride('');
        setShowSuccess(true);
        setTimeout(() => setShowSuccess(false), 2000);
      };
      
      const handleDelete = async (id) => {
        if (!confirm('Delete this entry?')) return;
        
        const newEntries = entries.filter(e => e.id !== id);
        setEntries(newEntries);
        localStorage.setItem('spanishVocab', JSON.stringify(newEntries));
        
        if (scriptUrl) {
          await api.deleteEntry(scriptUrl, id);
        }
      };
      
      const handleSaveSettings = () => {
        setScriptUrl(tempScriptUrl);
        localStorage.setItem('scriptUrl', tempScriptUrl);
        setConnectionStatus('unknown');
        loadEntries();
      };
      
      const handleChatSubmit = async (e) => {
        e.preventDefault();
        if (!chatInput.trim() || isChatLoading) return;
        
        const userMessage = chatInput.trim();
        setChatInput('');
        setChatMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setIsChatLoading(true);
        
        try {
          const context = word ? `\n\nContext: The user is currently adding the word "${word}" (${translation || 'no translation yet'}).` : '';
          
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 500,
              messages: [
                { 
                  role: 'user', 
                  content: `You are Bubble, a friendly Spanish learning assistant. You help with vocabulary, example sentences, related words, and grammar questions. Keep responses concise and helpful. Use Spanish naturally mixed with English explanations.${context}\n\nUser: ${userMessage}` 
                }
              ]
            })
          });
          
          const data = await response.json();
          const assistantMessage = data.content[0].text;
          setChatMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
        } catch (error) {
          setChatMessages(prev => [...prev, { 
            role: 'assistant', 
            content: 'Sorry, I had trouble connecting. Please try again!' 
          }]);
        }
        
        setIsChatLoading(false);
      };
      
      const exportToCSV = () => {
        const headers = ['Word', 'Translation', 'Category', 'Example', 'Created'];
        const rows = entries.map(e => [
          e.word, e.translation, e.category, e.example, e.createdAt
        ]);
        const csv = [headers, ...rows].map(r => r.map(c => `"${(c || '').replace(/"/g, '""')}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `spanish-vocab-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };
      
      const groupedEntries = entries.reduce((acc, entry) => {
        if (!acc[entry.category]) acc[entry.category] = [];
        acc[entry.category].push(entry);
        return acc;
      }, {});

      return (
        <div className="app-wrapper">
          <style>{`
            .app-wrapper {
              min-height: 100vh;
              min-height: 100dvh;
              background: linear-gradient(145deg, #faf6f1 0%, #f5ebe0 50%, #edded0 100%);
              padding: 16px;
              padding-bottom: env(safe-area-inset-bottom, 16px);
            }
            
            .app-container {
              max-width: 600px;
              margin: 0 auto;
            }
            
            .header {
              text-align: center;
              margin-bottom: 20px;
              padding: 16px;
            }
            
            .header h1 {
              font-family: 'Crimson Pro', Georgia, serif;
              font-size: 2rem;
              color: #5d4e37;
              margin: 0 0 6px 0;
              font-weight: 600;
            }
            
            .header p {
              color: #8b7355;
              margin: 0;
              font-size: 0.9rem;
            }
            
            .status-bar {
              display: flex;
              justify-content: center;
              gap: 12px;
              margin-top: 10px;
            }
            
            .status-badge {
              display: inline-flex;
              align-items: center;
              gap: 6px;
              padding: 4px 10px;
              border-radius: 20px;
              font-size: 0.75rem;
              font-weight: 500;
            }
            
            .status-badge.connected { background: #d4edda; color: #155724; }
            .status-badge.offline { background: #fff3cd; color: #856404; }
            .status-badge.syncing { background: #cce5ff; color: #004085; }
            
            .status-dot {
              width: 6px;
              height: 6px;
              border-radius: 50%;
              background: currentColor;
            }
            
            .tabs {
              display: flex;
              gap: 4px;
              margin-bottom: 16px;
              background: rgba(255,255,255,0.5);
              padding: 4px;
              border-radius: 12px;
              overflow-x: auto;
              -webkit-overflow-scrolling: touch;
            }
            
            .tab {
              flex: 1;
              min-width: fit-content;
              padding: 10px 12px;
              border: none;
              background: transparent;
              color: #8b7355;
              font-size: 0.85rem;
              font-weight: 500;
              cursor: pointer;
              border-radius: 8px;
              transition: all 0.2s ease;
              font-family: inherit;
              white-space: nowrap;
            }
            
            .tab:hover { background: rgba(255,255,255,0.5); }
            
            .tab.active {
              background: white;
              color: #5d4e37;
              box-shadow: 0 2px 8px rgba(93,78,55,0.1);
            }
            
            .card {
              background: white;
              border-radius: 16px;
              padding: 20px;
              box-shadow: 0 4px 20px rgba(93,78,55,0.08);
            }
            
            .form-group {
              margin-bottom: 16px;
            }
            
            .form-group label {
              display: block;
              color: #5d4e37;
              font-weight: 500;
              margin-bottom: 6px;
              font-size: 0.85rem;
            }
            
            .form-group input,
            .form-group textarea,
            .form-group select {
              width: 100%;
              padding: 12px 14px;
              border: 2px solid #e8dfd4;
              border-radius: 10px;
              font-size: 16px; /* Prevents zoom on iOS */
              font-family: inherit;
              transition: border-color 0.2s ease, box-shadow 0.2s ease;
              background: #fdfcfb;
              -webkit-appearance: none;
            }
            
            .form-group input:focus,
            .form-group textarea:focus,
            .form-group select:focus {
              outline: none;
              border-color: #c9a77c;
              box-shadow: 0 0 0 3px rgba(201,167,124,0.15);
            }
            
            .form-group textarea {
              resize: vertical;
              min-height: 70px;
            }
            
            .spanish-input {
              font-family: 'Crimson Pro', Georgia, serif;
              font-size: 18px !important;
            }
            
            .category-row {
              display: flex;
              flex-direction: column;
              gap: 10px;
            }
            
            @media (min-width: 480px) {
              .category-row {
                flex-direction: row;
                align-items: center;
              }
            }
            
            .detected-badge {
              display: inline-flex;
              align-items: center;
              gap: 6px;
              padding: 8px 12px;
              background: linear-gradient(135deg, #f0e6d8 0%, #e8dcc8 100%);
              border-radius: 20px;
              color: #6b5a45;
              font-size: 0.85rem;
              font-weight: 500;
            }
            
            .detected-badge::before {
              content: '‚ú®';
              font-size: 0.85rem;
            }
            
            .submit-btn {
              width: 100%;
              padding: 14px;
              background: linear-gradient(135deg, #8b7355 0%, #6b5a45 100%);
              color: white;
              border: none;
              border-radius: 10px;
              font-size: 1rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s ease, box-shadow 0.2s ease;
              font-family: inherit;
              -webkit-tap-highlight-color: transparent;
            }
            
            .submit-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(93,78,55,0.25);
            }
            
            .submit-btn:active { transform: translateY(0); }
            .submit-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
            
            .success-toast {
              position: fixed;
              bottom: 30px;
              left: 50%;
              transform: translateX(-50%);
              background: #5d8a66;
              color: white;
              padding: 12px 24px;
              border-radius: 30px;
              font-weight: 500;
              font-size: 0.9rem;
              box-shadow: 0 6px 20px rgba(93,138,102,0.35);
              animation: slideUp 0.3s ease;
              z-index: 100;
            }
            
            @keyframes slideUp {
              from { opacity: 0; transform: translate(-50%, 20px); }
              to { opacity: 1; transform: translate(-50%, 0); }
            }
            
            .chat-container {
              display: flex;
              flex-direction: column;
              height: 450px;
            }
            
            .chat-messages {
              flex: 1;
              overflow-y: auto;
              padding: 12px;
              display: flex;
              flex-direction: column;
              gap: 10px;
              -webkit-overflow-scrolling: touch;
            }
            
            .chat-message {
              max-width: 85%;
              padding: 10px 14px;
              border-radius: 16px;
              line-height: 1.5;
              font-size: 0.9rem;
            }
            
            .chat-message.user {
              align-self: flex-end;
              background: linear-gradient(135deg, #8b7355 0%, #6b5a45 100%);
              color: white;
              border-bottom-right-radius: 4px;
            }
            
            .chat-message.assistant {
              align-self: flex-start;
              background: #f5ebe0;
              color: #5d4e37;
              border-bottom-left-radius: 4px;
            }
            
            .chat-input-row {
              display: flex;
              gap: 8px;
              padding: 12px;
              border-top: 1px solid #e8dfd4;
            }
            
            .chat-input-row input {
              flex: 1;
              padding: 10px 14px;
              border: 2px solid #e8dfd4;
              border-radius: 24px;
              font-size: 16px;
              font-family: inherit;
            }
            
            .chat-input-row input:focus {
              outline: none;
              border-color: #c9a77c;
            }
            
            .chat-send-btn {
              padding: 10px 16px;
              background: linear-gradient(135deg, #8b7355 0%, #6b5a45 100%);
              color: white;
              border: none;
              border-radius: 24px;
              font-weight: 500;
              cursor: pointer;
              font-family: inherit;
              -webkit-tap-highlight-color: transparent;
            }
            
            .chat-send-btn:disabled { opacity: 0.6; }
            
            .vocab-section {
              margin-bottom: 20px;
            }
            
            .vocab-section h3 {
              font-family: 'Crimson Pro', Georgia, serif;
              color: #5d4e37;
              font-size: 1.2rem;
              margin: 0 0 10px 0;
              padding-bottom: 8px;
              border-bottom: 2px solid #e8dfd4;
            }
            
            .vocab-item {
              display: flex;
              justify-content: space-between;
              align-items: flex-start;
              padding: 10px 0;
              border-bottom: 1px solid #f0e6d8;
            }
            
            .vocab-item:last-child { border-bottom: none; }
            
            .vocab-word {
              font-family: 'Crimson Pro', Georgia, serif;
              font-size: 1.1rem;
              color: #5d4e37;
              font-weight: 600;
            }
            
            .vocab-translation {
              color: #8b7355;
              font-size: 0.9rem;
              margin-top: 2px;
            }
            
            .vocab-example {
              color: #a89070;
              font-size: 0.8rem;
              font-style: italic;
              margin-top: 4px;
            }
            
            .vocab-delete {
              background: none;
              border: none;
              color: #c9a77c;
              cursor: pointer;
              padding: 4px 8px;
              font-size: 1.2rem;
              opacity: 0.5;
              -webkit-tap-highlight-color: transparent;
            }
            
            .vocab-delete:hover, .vocab-delete:active { opacity: 1; color: #c97c7c; }
            
            .action-row {
              display: flex;
              gap: 8px;
              margin-bottom: 16px;
              flex-wrap: wrap;
            }
            
            .action-btn {
              padding: 8px 16px;
              background: transparent;
              border: 2px solid #c9a77c;
              color: #8b7355;
              border-radius: 8px;
              font-weight: 500;
              cursor: pointer;
              font-family: inherit;
              font-size: 0.85rem;
              -webkit-tap-highlight-color: transparent;
            }
            
            .action-btn:hover, .action-btn:active {
              background: #c9a77c;
              color: white;
            }
            
            .empty-state {
              text-align: center;
              padding: 30px;
              color: #a89070;
            }
            
            .empty-state span {
              font-size: 2rem;
              display: block;
              margin-bottom: 10px;
            }
            
            .loading-dots::after {
              content: '';
              animation: dots 1.5s infinite;
            }
            
            @keyframes dots {
              0%, 20% { content: '.'; }
              40% { content: '..'; }
              60%, 100% { content: '...'; }
            }
            
            .settings-section {
              margin-bottom: 20px;
              padding-bottom: 20px;
              border-bottom: 1px solid #e8dfd4;
            }
            
            .settings-section:last-child {
              border-bottom: none;
              padding-bottom: 0;
              margin-bottom: 0;
            }
            
            .settings-section h3 {
              font-family: 'Crimson Pro', Georgia, serif;
              color: #5d4e37;
              margin: 0 0 12px 0;
              font-size: 1.1rem;
            }
            
            .settings-section p {
              color: #8b7355;
              font-size: 0.85rem;
              margin: 0 0 10px 0;
              line-height: 1.5;
            }
            
            .settings-row {
              display: flex;
              gap: 8px;
              flex-direction: column;
            }
            
            @media (min-width: 480px) {
              .settings-row {
                flex-direction: row;
              }
              .settings-row input { flex: 1; }
            }
            
            .word-count {
              text-align: center;
              color: #8b7355;
              font-size: 0.85rem;
              margin-bottom: 16px;
            }
            
            .loading-spinner {
              text-align: center;
              padding: 30px;
              color: #8b7355;
            }
          `}</style>
          
          <div className="app-container">
            <header className="header">
              <h1>Mi Vocabulario</h1>
              <p>Your Spanish learning companion</p>
              <div className="status-bar">
                {isSyncing && (
                  <span className="status-badge syncing">
                    <span className="status-dot"></span>
                    Syncing...
                  </span>
                )}
                {!isSyncing && scriptUrl && connectionStatus === 'connected' && (
                  <span className="status-badge connected">
                    <span className="status-dot"></span>
                    Synced
                  </span>
                )}
                {!isSyncing && scriptUrl && connectionStatus === 'offline' && (
                  <span className="status-badge offline">
                    <span className="status-dot"></span>
                    Offline
                  </span>
                )}
              </div>
            </header>
            
            <div className="tabs">
              <button className={`tab ${activeTab === 'entry' ? 'active' : ''}`} onClick={() => setActiveTab('entry')}>
                ‚úèÔ∏è Add
              </button>
              <button className={`tab ${activeTab === 'chat' ? 'active' : ''}`} onClick={() => setActiveTab('chat')}>
                üí¨ Bubble
              </button>
              <button className={`tab ${activeTab === 'vocab' ? 'active' : ''}`} onClick={() => setActiveTab('vocab')}>
                üìö Words
              </button>
              <button className={`tab ${activeTab === 'settings' ? 'active' : ''}`} onClick={() => setActiveTab('settings')}>
                ‚öôÔ∏è
              </button>
            </div>
            
            {activeTab === 'entry' && (
              <div className="card">
                <form onSubmit={handleSubmit}>
                  <div className="form-group">
                    <label>Spanish Word</label>
                    <input
                      type="text"
                      className="spanish-input"
                      value={word}
                      onChange={(e) => setWord(e.target.value)}
                      placeholder="e.g., hermoso"
                      autoComplete="off"
                    />
                  </div>
                  
                  <div className="form-group">
                    <label>English Translation</label>
                    <input
                      type="text"
                      value={translation}
                      onChange={(e) => setTranslation(e.target.value)}
                      placeholder="e.g., beautiful, gorgeous"
                      autoComplete="off"
                    />
                  </div>
                  
                  <div className="form-group">
                    <label>Example Sentence (optional)</label>
                    <textarea
                      className="spanish-input"
                      value={example}
                      onChange={(e) => setExample(e.target.value)}
                      placeholder="e.g., El lago es hermoso"
                    />
                  </div>
                  
                  <div className="form-group">
                    <label>Category</label>
                    <div className="category-row">
                      <div className="detected-badge">{detectedCategory}</div>
                      <select
                        value={categoryOverride}
                        onChange={(e) => setCategoryOverride(e.target.value)}
                      >
                        <option value="">Keep detected</option>
                        {categories.map(cat => (
                          <option key={cat} value={cat}>{cat}</option>
                        ))}
                      </select>
                    </div>
                  </div>
                  
                  <button type="submit" className="submit-btn" disabled={!word.trim() || !translation.trim()}>
                    Add to Vocabulary
                  </button>
                </form>
              </div>
            )}
            
            {activeTab === 'chat' && (
              <div className="card">
                <div style={{ textAlign: 'center', padding: '40px 20px' }}>
                  <div style={{ fontSize: '3rem', marginBottom: '16px' }}>üí¨</div>
                  <h3 style={{ fontFamily: "'Crimson Pro', Georgia, serif", color: '#5d4e37', margin: '0 0 12px 0', fontSize: '1.4rem' }}>Chat with Bubble</h3>
                  <p style={{ color: '#8b7355', lineHeight: '1.6', margin: '0 0 24px 0' }}>
                    For help with examples, grammar questions, or practice ‚Äî open the Claude app!
                  </p>
                  <a 
                    href="https://claude.ai" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    style={{
                      display: 'inline-block',
                      padding: '14px 28px',
                      background: 'linear-gradient(135deg, #8b7355 0%, #6b5a45 100%)',
                      color: 'white',
                      textDecoration: 'none',
                      borderRadius: '10px',
                      fontWeight: '600',
                      fontSize: '1rem'
                    }}
                  >
                    Open Claude ‚Üí
                  </a>
                  <p style={{ color: '#a89070', fontSize: '0.85rem', marginTop: '20px' }}>
                    Tip: Share your vocab sheet with me and I can quiz you!
                  </p>
                </div>
              </div>
            )}
            
            {activeTab === 'vocab' && (
              <div className="card">
                {isLoading ? (
                  <div className="loading-spinner">Loading...</div>
                ) : (
                  <>
                    {entries.length > 0 && (
                      <>
                        <div className="action-row">
                          <button className="action-btn" onClick={exportToCSV}>üì• Export</button>
                          <button className="action-btn" onClick={loadEntries}>üîÑ Refresh</button>
                        </div>
                        <p className="word-count">{entries.length} words</p>
                      </>
                    )}
                    
                    {entries.length === 0 ? (
                      <div className="empty-state">
                        <span>üìù</span>
                        <p>No words yet!</p>
                      </div>
                    ) : (
                      categories.map(cat => (
                        groupedEntries[cat]?.length > 0 && (
                          <div key={cat} className="vocab-section">
                            <h3>{cat} ({groupedEntries[cat].length})</h3>
                            {groupedEntries[cat].map(entry => (
                              <div key={entry.id} className="vocab-item">
                                <div>
                                  <div className="vocab-word">{entry.word}</div>
                                  <div className="vocab-translation">{entry.translation}</div>
                                  {entry.example && <div className="vocab-example">{entry.example}</div>}
                                </div>
                                <button className="vocab-delete" onClick={() => handleDelete(entry.id)}>√ó</button>
                              </div>
                            ))}
                          </div>
                        )
                      ))
                    )}
                  </>
                )}
              </div>
            )}
            
            {activeTab === 'settings' && (
              <div className="card">
                <div className="settings-section">
                  <h3>üîó Google Sheets</h3>
                  <p>Connect to sync your vocabulary across devices.</p>
                  <div className="settings-row">
                    <input
                      type="text"
                      value={tempScriptUrl}
                      onChange={(e) => setTempScriptUrl(e.target.value)}
                      placeholder="Apps Script Web App URL"
                    />
                    <button className="action-btn" onClick={handleSaveSettings}>Save</button>
                  </div>
                  {scriptUrl && (
                    <p style={{ marginTop: '10px' }}>
                      {connectionStatus === 'connected' ? '‚úÖ Connected' : connectionStatus === 'offline' ? '‚ö†Ô∏è Offline' : '‚ùì Not tested'}
                    </p>
                  )}
                </div>
                
                <div className="settings-section">
                  <h3>üìä Data</h3>
                  <p><strong>{entries.length}</strong> words saved locally</p>
                </div>
              </div>
            )}
            
            {showSuccess && <div className="success-toast">‚úì Added!</div>}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<VocabularyApp />);
  </script>
</body>
</html>
